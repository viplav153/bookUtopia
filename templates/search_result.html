{% extends 'base.html' %}
{% block content %}


<!-- <link rel="stylesheet" href="/static/style.css"> -->
<div>
    
     
    {% for item in results["results"] %}
   
    <p><img src="{{item.book_cover}}" /></p>
    <p>Title:<i>{{ item.title }}</i></p>
    <p>Author: {{ item.author[2:-2] }}</p>
    <p>ISBN: {{ item.ISBN }}</p>

    {% endfor %}

</div>

<style type="text/css">
  html, body { height: 100%; margin: 0; padding: 0; }
  #map { height: 100%; }
</style>

<body>
<div id="map"></div>

<script type="text/javascript">


  const books = ({{ results | tojson }});
  zipcode = books.results[0].zipcode;
  console.log(zipcode);


  function initMap() {


  var getLatLngByZipcode = function(zipcode) {
    
    var geocoder = new google.maps.Geocoder();
    var address = zipcode;
    geocoder.geocode({ 'address': address }, function (results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            latitude = results[0].geometry.location.lat();
            longitude = results[0].geometry.location.lng();
            alert ("Latitude: " + latitude + "\nLongitude: " + longitude);
        } else {
            alert("Request failed.")
        }
    });
    return [latitude, longitude];

  };
  
  console.log(getLatLngByZipcode('zipcode'))

  const sfBayCoords = { lat: latitude , lng: longitude };

  const map = new google.maps.Map(document.getElementById('map'), {
    center: sfBayCoords,
    zoom: 8
  });

  const sfMarker = addMarker('static/imgs/marker.png', sfBayCoords, 'SF Bay', map);
  sfMarker.addListener('click', () => alert('Hello!'));
  // Loop over hackbrightLocations to make lots of markers
  const markers = [];

  for (let book of books.results) {
    console.log(book)
    
    // markers.push(addMarker('static/imgs/marker.png', hbLocation.coords, hbLocation.name, map));
  }
  // Loop over markers list to attach click handlers
  for (let marker of markers) {
    const aboutLocation = `<h1>BookLot - ${books.results[0].title}</h1>
      <p>Located at</p>
      <ul>
        <li><b>Lat:</b> ${marker.position.lat()}</li>
        <li><b>Lng:</b> ${marker.position.lng()}</li>
      </ul>
      `;
    addInfoWindowToMarker(aboutLocation, marker, map);
  }
}
/**
 * Utility/helper functions
 */
function addMarker(icon, position, title, map) {
  const marker = new google.maps.Marker({ position, map, title, icon });
  return marker;
}

function addInfoWindowToMarker(content, marker, map) {
  const infoWindow = new google.maps.InfoWindow({
    content,
    maxWidth: 200
  });
  marker.addListener('click', () => infoWindow.open(map, marker));
}

</script>


<script async defer src={{script_url}}></script>
</body>


        
{% endblock %} 

